<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Link Cashback - Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f6fa;
        color: #333;
      }

      /* NAVBAR */
      .navbar-dashboard {
        background: linear-gradient(135deg, #dc143c 0%, #b30000 100%);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        padding: 15px 20px;
      }

      .navbar-dashboard .navbar-brand {
        font-weight: 900;
        font-size: 20px;
        color: white;
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
        padding: 6px 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .logout-btn:hover {
        background: white;
        color: #dc143c;
      }

      /* MAIN CONTAINER */
      .dashboard-container {
        padding: 20px 15px;
      }

      /* TABS */
      .nav-tabs {
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 20px;
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
      }

      .nav-tabs::-webkit-scrollbar {
        height: 3px;
      }

      .nav-tabs::-webkit-scrollbar-thumb {
        background: #dc143c;
        border-radius: 3px;
      }

      .nav-tabs .nav-link {
        color: #666;
        border: none;
        border-bottom: 3px solid transparent;
        padding: 10px 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        white-space: nowrap;
        font-size: 14px;
      }

      .nav-tabs .nav-link:hover {
        color: #dc143c;
      }

      .nav-tabs .nav-link.active {
        color: #dc143c;
        border-bottom-color: #dc143c;
        background: none;
      }

      /* CARDS */
      .card-stat {
        background: white;
        border: none;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
      }

      .card-stat:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      }

      .stat-icon {
        font-size: 28px;
        margin-bottom: 8px;
      }

      .stat-label {
        font-size: 13px;
        color: #999;
        margin-bottom: 6px;
        font-weight: 600;
      }

      .stat-value {
        font-size: 22px;
        font-weight: 900;
        color: #dc143c;
      }

      .stat-subtitle {
        font-size: 11px;
        color: #bbb;
        margin-top: 6px;
      }

      /* PROFILE SECTION */
      .profile-card {
        background: linear-gradient(135deg, #dc143c 0%, #b30000 100%);
        color: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .profile-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .profile-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        flex-shrink: 0;
      }

      .profile-info h3 {
        font-size: 18px;
        font-weight: 900;
        margin-bottom: 5px;
      }

      .profile-info p {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 3px;
      }

      .referral-section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
      }

      .referral-section h5 {
        margin-bottom: 12px;
        font-weight: 700;
        font-size: 14px;
      }

      .referral-section h6 {
        margin-bottom: 8px;
        font-size: 12px;
      }

      .referral-section p {
        margin-bottom: 6px;
        font-size: 12px;
      }

      .referral-code {
        background: rgba(255, 255, 255, 0.2);
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .referral-code .code {
        font-weight: 700;
        font-size: 12px;
        font-family: monospace;
        word-break: break-all;
        flex: 1;
        min-width: 150px;
      }

      .btn-copy {
        background: white;
        color: #dc143c;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 12px;
        white-space: nowrap;
      }

      .btn-copy:hover {
        background: #f0f0f0;
      }

      /* EARNINGS GRID */
      .earnings-grid {
        margin-bottom: 20px;
      }

      .earnings-card {
        background: white;
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border-left: 5px solid #dc143c;
        margin-bottom: 15px;
      }

      .earnings-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      }

      .earnings-header {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .earnings-icon {
        font-size: 32px;
        min-width: 50px;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .earnings-icon.total {
        background: rgba(220, 20, 60, 0.1);
        border-radius: 10px;
        color: #dc143c;
      }

      .earnings-icon.pending {
        background: rgba(255, 193, 7, 0.1);
        border-radius: 10px;
        color: #ffc107;
      }

      .earnings-icon.success {
        background: rgba(76, 175, 80, 0.1);
        border-radius: 10px;
        color: #4caf50;
      }

      .earnings-info {
        flex: 1;
        min-width: 0;
      }

      .earnings-label {
        font-size: 12px;
        color: #999;
        font-weight: 600;
        margin-bottom: 6px;
      }

      .earnings-amount {
        font-size: 18px;
        font-weight: 900;
        color: #dc143c;
        word-break: break-word;
      }

      .earnings-amount.pending-text {
        color: #ffc107;
      }

      .earnings-amount.success-text {
        color: #4caf50;
      }

      /* INFO ICON */
      .info-icon {
        cursor: pointer;
        margin-left: 5px;
        font-size: 14px;
        opacity: 0.7;
        transition: all 0.3s ease;
        display: inline-block;
      }

      .info-icon:hover {
        opacity: 1;
        transform: scale(1.2);
      }

      /* WITHDRAW SECTION */
      .withdraw-section {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        margin-top: 20px;
      }

      .withdraw-section h5 {
        margin-bottom: 12px;
        font-weight: 700;
        font-size: 16px;
      }

      .withdraw-info {
        background: #f9f9f9;
        padding: 12px;
        border-radius: 10px;
        border-left: 4px solid #dc143c;
        margin-bottom: 15px;
      }

      .withdraw-info p {
        margin-bottom: 8px;
        font-size: 13px;
      }

      .btn-withdraw {
        background: linear-gradient(135deg, #dc143c 0%, #b30000 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }

      .btn-withdraw:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(220, 20, 60, 0.3);
      }

      .generasi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .generasi-card {
        background: white;
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      }

      .generasi-card .label {
        font-size: 11px;
        color: #999;
        margin-bottom: 6px;
        font-weight: 600;
      }

      .generasi-card .value {
        font-size: 20px;
        font-weight: 900;
        color: #dc143c;
      }

      /* TABLE */
      .table-responsive-custom {
        background: white;
        border-radius: 15px;
        overflow-x: auto;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }

      .table-responsive-custom table {
        margin-bottom: 0;
        min-width: 600px;
      }

      .table-responsive-custom thead {
        background: #f5f6fa;
        border-bottom: 2px solid #e0e0e0;
      }

      .table-responsive-custom th {
        padding: 12px;
        font-weight: 700;
        color: #333;
        border: none;
        font-size: 13px;
        white-space: nowrap;
      }

      .table-responsive-custom td {
        padding: 12px;
        border-color: #e0e0e0;
        font-size: 13px;
      }

      .table-responsive-custom tbody tr:hover {
        background: #f9f9f9;
      }

      .badge-gen {
        background: #dc143c;
        color: white;
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        white-space: nowrap;
      }

      /* FILTER SECTION */
      .filter-section {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }

      .filter-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
      }

      .filter-row .form-group {
        margin-bottom: 0;
      }

      .filter-row label {
        font-weight: 600;
        color: #333;
        margin-bottom: 6px;
        display: block;
        font-size: 13px;
      }

      .filter-row input,
      .filter-row select {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 13px;
        transition: border-color 0.3s ease;
        width: 100%;
      }

      .filter-row input:focus,
      .filter-row select:focus {
        outline: none;
        border-color: #dc143c;
        box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.1);
      }

      .btn-filter {
        background: linear-gradient(135deg, #dc143c 0%, #b30000 100%);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 13px;
        white-space: nowrap;
      }

      .btn-filter:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
      }

      .btn-filter.secondary {
        background: #f0f0f0;
        color: #333;
      }

      .btn-filter.secondary:hover {
        background: #e0e0e0;
      }

      /* MODAL */
      .modal-header {
        background: linear-gradient(135deg, #dc143c 0%, #b30000 100%);
        color: white;
        border: none;
      }

      .modal-header .btn-close {
        filter: brightness(0) invert(1);
      }

      /* Status & Rank Cards */
      .status-card {
        transition: 0.2s;
      }
      .status-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .rank-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
      }

      .rank-card {
        background-color: white;
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        transition: 0.2s;
        cursor: pointer;
      }

      .rank-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .rank-card h6 {
        font-weight: 600;
        margin-bottom: 6px;
        font-size: 13px;
      }

      .rank-card .count {
        font-size: 18px;
        font-weight: bold;
      }

      .rank-bronze {
        background-color: #fe7f00;
        color: white;
      }
      .rank-silver {
        background-color: #b7b3b3;
        color: black;
      }
      .rank-gold {
        background-color: #ffcc00;
        color: black;
      }
      .rank-platinum {
        background-color: #e5e4e2;
        color: black;
      }
      .rank-diamond {
        background-color: #57defc;
        color: black;
      }

      h4 {
        font-size: 18px;
        font-weight: 900;
        margin: 20px 0 15px;
      }

      h5 {
        font-size: 16px;
      }

      /* RESPONSIVE BREAKPOINTS */
      @media (max-width: 992px) {
        .generasi-grid {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }

        .rank-grid {
          grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .dashboard-container {
          padding: 15px 10px;
        }

        .navbar-dashboard {
          padding: 12px 15px;
        }

        .navbar-dashboard .navbar-brand {
          font-size: 16px;
        }

        .card-stat {
          padding: 15px;
        }

        .profile-header {
          flex-direction: column;
          text-align: center;
        }

        .profile-avatar {
          width: 50px;
          height: 50px;
          font-size: 24px;
        }

        .profile-info h3 {
          font-size: 16px;
        }

        .profile-info p {
          font-size: 11px;
        }

        .stat-value {
          font-size: 18px;
        }

        .stat-icon {
          font-size: 24px;
        }

        .earnings-amount {
          font-size: 16px;
        }

        .earnings-icon {
          font-size: 28px;
          min-width: 45px;
          width: 45px;
          height: 45px;
        }

        .nav-tabs .nav-link {
          padding: 8px 12px;
          font-size: 13px;
        }

        h4 {
          font-size: 16px;
        }

        .filter-row {
          grid-template-columns: 1fr;
        }

        .generasi-grid {
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 10px;
        }

        .generasi-card {
          padding: 10px;
        }

        .generasi-card .value {
          font-size: 18px;
        }

        .rank-grid {
          grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        }

        .withdraw-section {
          padding: 15px;
        }

        .table-responsive-custom th,
        .table-responsive-custom td {
          padding: 10px 8px;
          font-size: 12px;
        }
      }

      @media (max-width: 480px) {
        .navbar-dashboard .navbar-brand {
          font-size: 14px;
        }

        .logout-btn {
          padding: 5px 10px;
          font-size: 12px;
        }

        .referral-code {
          flex-direction: column;
          align-items: stretch;
        }

        .referral-code .code {
          text-align: center;
          min-width: auto;
        }

        .btn-copy {
          width: 100%;
        }

        .generasi-grid {
          grid-template-columns: repeat(3, 1fr);
        }

        .rank-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar-dashboard">
      <div
        class="container-fluid d-flex justify-content-between align-items-center"
      >
        <div class="d-flex align-items-center">
          <img
            src="../assets/img/testimonials/logow.png"
            width="80px"
            alt="Link logo"
          />
        </div>
        <div>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
    </nav>

    <div class="dashboard-container">
      <div class="container-fluid">
        <!-- TABS -->
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#dashboard"
              >Dashboard</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#team">Tim Saya</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#earnings"
              >Penghasilan</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#withdraw-history"
              >Penarikan</a
            >
          </li>
        </ul>

        <!-- TAB CONTENT -->
        <div class="tab-content">
          <!-- DASHBOARD TAB -->
          <div id="dashboard" class="tab-pane fade show active">
            <!-- PROFILE CARD -->
            <div class="profile-card">
              <div class="profile-header">
                <div class="profile-avatar">üë§</div>
                <div class="profile-info">
                  <!-- <p>User Name</p> -->
                  <!-- <h3 id="profileName">Loading...</h3>
                  <p>Email: <span id="profileEmail">Loading...</span></p> -->
                  <div style="display: flex; align-items: center; gap: 8px">
                    <h3>User Name :</h3>
                    <h3 id="profileName">Loading...</h3>
                  </div>
                  <p>Rank : <span id="profileRole">Bronze</span></p>
                </div>
              </div>

              <div class="referral-section">
                <h5>üîó Link Referral Saya</h5>
                <div class="referral-code">
                  <div class="code" id="referralLink">
                    https://linkcashback.com/ref/...
                  </div>
                  <button class="btn-copy" onclick="copyReferralLink()">
                    üìã Salin
                  </button>
                </div>
                <div class="row">
                  <div class="col-12">
                    <h6>Statistik Referral</h6>
                    <p>
                      ‚úÖ Total Referral:
                      <strong id="totalReferrals">0 orang</strong>
                    </p>
                    <p>
                      üí∞ Komisi Pendaftaran:
                      <strong id="regCommission">Rp 0</strong>
                    </p>
                    <p>üéÅ Bonus Tim: <strong id="teamBonus">Rp 0</strong></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- EARNINGS STATUS GRID -->
            <h4>üí≥ Status Pendapatan Saya</h4>
            <div class="row earnings-grid">
              <div class="col-md-4">
                <div class="earnings-card">
                  <div class="earnings-header">
                    <div class="earnings-icon total">üí∞</div>
                    <div class="earnings-info">
                      <div class="earnings-label">
                        Total Pendapatan
                        <span class="info-icon" onclick="showInfoModal('total')"
                          >‚ùì</span
                        >
                      </div>
                      <div class="earnings-amount" id="totalIncome">Rp 0</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="earnings-card">
                  <div class="earnings-header">
                    <div class="earnings-icon pending">‚è≥</div>
                    <div class="earnings-info">
                      <div class="earnings-label">
                        Pendapatan Tertunda
                        <span
                          class="info-icon"
                          onclick="showInfoModal('pending')"
                          >‚ùì</span
                        >
                      </div>
                      <div
                        class="earnings-amount pending-text"
                        id="pendingIncome"
                      >
                        Rp 0
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="earnings-card">
                  <div class="earnings-header">
                    <div class="earnings-icon success">‚úÖ</div>
                    <div class="earnings-info">
                      <div class="earnings-label">
                        Pendapatan Berhasil
                        <span
                          class="info-icon"
                          onclick="showInfoModal('success')"
                          >‚ùì</span
                        >
                      </div>
                      <div
                        class="earnings-amount success-text"
                        id="successIncome"
                      >
                        Rp 0
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- WITHDRAW SECTION -->
            <div class="withdraw-section">
              <h5>üè¶ Tarik Saldo</h5>
              <div class="withdraw-info">
                <p>
                  <strong>Saldo Tersedia:</strong>
                  <span
                    id="availableBalance"
                    style="color: #dc143c; font-weight: 700; font-size: 16px"
                    >Rp 0</span
                  >
                </p>
                <p style="font-size: 12px; color: #999; margin-bottom: 0">
                  Penarikan Kelipatan <strong>Rp 50.000</strong>
                </p>
              </div>
              <button class="btn-withdraw" onclick="openWithdrawModal()">
                üí≥ Tarik Saldo
              </button>
            </div>
            <!-- pages penarikan saldo -->
            <!-- STATISTICS -->
            <h4>üìä Total Penghasilan</h4>
            <div class="row">
              <div class="col-md-4">
                <div class="card-stat">
                  <div class="stat-icon">üí∞</div>
                  <div class="stat-label">Total Penghasilan</div>
                  <div class="stat-value" id="totalEarnings">Rp 0</div>
                  <div class="stat-subtitle">Bulan ini</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card-stat">
                  <div class="stat-icon">üéØ</div>
                  <div class="stat-label">Komisi Cashback</div>
                  <div class="stat-value" id="cashbackComission">Rp 0</div>
                  <div class="stat-subtitle">Dari pembelian tim</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card-stat">
                  <div class="stat-icon">üéÅ</div>
                  <div class="stat-label">Komisi Pendaftaran</div>
                  <div class="stat-value" id="registrationComission">Rp 0</div>
                  <div class="stat-subtitle">Dari referral baru</div>
                </div>
              </div>
            </div>

            <!-- GENERASI -->
            <h4>üë• Generasi Tim (1-10)</h4>
            <div class="generasi-grid" id="generasiGrid"></div>
          </div>

          <!-- TEAM TAB -->
          <div id="team" class="tab-pane fade">
            <h4>üë• Informasi Tim Saya</h4>
            <div class="table-responsive-custom">
              <table class="table">
                <thead>
                  <tr>
                    <th>Generasi</th>
                    <th>Jumlah Member</th>
                    <th>Komisi Pendaftaran</th>
                    <th>Komisi Cashback</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody id="teamTableBody"></tbody>
              </table>
            </div>

            <!-- STATUS TIM -->
            <div class="row mt-4">
              <h5 class="mb-3">üìä Status Tim</h5>
              <div class="col-md-6 mb-3">
                <div
                  class="status-card bg-danger text-white text-center p-3 rounded-3 shadow-sm"
                >
                  <h6>User</h6>
                  <h3 id="userCount">0</h3>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div
                  class="status-card bg-danger text-white text-center p-3 rounded-3 shadow-sm"
                >
                  <h6>Partner</h6>
                  <h3 id="partnerCount">0</h3>
                </div>
              </div>
            </div>

            <!-- RANK QUALIFIED -->
            <div class="mt-4">
              <h5 class="mb-3">üèÖ Rank Qualified</h5>
              <div class="rank-grid" id="rankGrid"></div>
            </div>
          </div>

          <!-- EARNINGS TAB -->
          <div id="earnings" class="tab-pane fade">
            <h4>üí∞ Riwayat Penghasilan Detail</h4>
            <div class="filter-section">
              <div class="filter-row">
                <div class="form-group">
                  <label for="filterGenerasi">Filter Generasi</label>
                  <select id="filterGenerasi" class="form-control">
                    <option value="">Semua Generasi</option>
                    <option value="1">Generasi 1</option>
                    <option value="2">Generasi 2</option>
                    <option value="3">Generasi 3</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterTanggalAwal">Tanggal Awal</label>
                  <input
                    type="date"
                    id="filterTanggalAwal"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label for="filterTanggalAkhir">Tanggal Akhir</label>
                  <input
                    type="date"
                    id="filterTanggalAkhir"
                    class="form-control"
                  />
                </div>
                <button class="btn-filter" onclick="filterEarnings()">
                  üîç Filter
                </button>
                <button class="btn-filter secondary" onclick="resetFilter()">
                  üîÑ Reset
                </button>
              </div>
            </div>
            <div class="table-responsive-custom">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Gen</th>
                    <th>Member</th>
                    <th>Jenis</th>
                    <th>Nominal</th>
                  </tr>
                </thead>
                <tbody id="earningsTableBody"></tbody>
              </table>
            </div>
          </div>

          <!-- WITHDRAW HISTORY TAB -->
          <div id="withdraw-history" class="tab-pane fade">
            <h4>üè¶ Riwayat Penarikan</h4>
            <div class="filter-section">
              <div class="filter-row">
                <div class="form-group">
                  <label>Tanggal Awal</label>
                  <input
                    type="date"
                    id="filterTanggalAwalWD"
                    class="form-control"
                  />
                </div>
                <div class="form-group">
                  <label>Tanggal Akhir</label>
                  <input
                    type="date"
                    id="filterTanggalAkhirWD"
                    class="form-control"
                  />
                </div>
                <button class="btn-filter" onclick="filterWithdrawHistory()">
                  üîç Filter
                </button>
                <button
                  class="btn-filter secondary"
                  onclick="resetWithdrawFilter()"
                >
                  üîÑ Reset
                </button>
              </div>
            </div>
            <div class="table-responsive-custom">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Nominal</th>
                    <th>Status</th>
                    <th>Catatan</th>
                  </tr>
                </thead>
                <tbody id="withdrawTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- MODAL RANK DETAIL -->
        <div class="modal fade" id="rankDetailModal" tabindex="-1">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">
                  üìä User Rank <span id="rankTitle">Bronze</span>
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>
              <div class="modal-body">
                <div class="table-responsive-custom">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>No.</th>
                        <th>Username</th>
                        <th>Nama</th>
                        <th>WA</th>
                        <th>Sponsor</th>
                      </tr>
                    </thead>
                    <tbody id="rankDetailTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- MODAL INFO -->
        <div class="modal fade" id="infoModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="infoModalTitle">‚ÑπÔ∏è Informasi</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                ></button>
              </div>
              <div class="modal-body" id="infoModalBody">
                <!-- Konten akan diisi via JavaScript -->
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      // üé≠ DATA DUMMY BERDASARKAN USER
      const DUMMY_DATA = {
        admin: {
          totalReferrals: 50,
          regCommission: 5000000,
          teamBonus: 10000000,
          totalIncome: 15000000,
          pendingIncome: 1000000,
          successIncome: 14000000,
          availableBalance: 14000000,
          cashbackComission: 8000000,
          registrationComission: 5000000,
          generasi: {
            1: 25,
            2: 18,
            3: 15,
            4: 12,
            5: 10,
            6: 8,
            7: 6,
            8: 4,
            9: 2,
            10: 1,
          },
          userCount: 50,
          partnerCount: 51,
        },
        user123: {
          totalReferrals: 25,
          regCommission: 2500000,
          teamBonus: 5000000,
          totalIncome: 7500000,
          pendingIncome: 500000,
          successIncome: 7000000,
          availableBalance: 7000000,
          cashbackComission: 5000000,
          registrationComission: 2500000,
          generasi: {
            1: 15,
            2: 10,
            3: 8,
            4: 6,
            5: 5,
            6: 3,
            7: 2,
            8: 1,
            9: 0,
            10: 0,
          },
          userCount: 25,
          partnerCount: 25,
        },
        member1: {
          totalReferrals: 10,
          regCommission: 1000000,
          teamBonus: 2000000,
          totalIncome: 3000000,
          pendingIncome: 300000,
          successIncome: 2700000,
          availableBalance: 2700000,
          cashbackComission: 2000000,
          registrationComission: 1000000,
          generasi: {
            1: 8,
            2: 5,
            3: 3,
            4: 2,
            5: 1,
            6: 0,
            7: 0,
            8: 0,
            9: 0,
            10: 0,
          },
          userCount: 10,
          partnerCount: 9,
        },
      };

      const EARNINGS_DATA = [
        {
          tanggal: "2024-11-08",
          generasi: 1,
          member: "Ahmad Wijaya",
          jenis: "registration",
          nominal: 100000,
        },
        {
          tanggal: "2024-11-07",
          generasi: 2,
          member: "Budi Santoso",
          jenis: "cashback",
          nominal: 250000,
        },
        {
          tanggal: "2024-11-06",
          generasi: 1,
          member: "Citra Dewi",
          jenis: "registration",
          nominal: 100000,
        },
        {
          tanggal: "2024-11-05",
          generasi: 3,
          member: "Dedi Gunawan",
          jenis: "cashback",
          nominal: 150000,
        },
        {
          tanggal: "2024-11-04",
          generasi: 1,
          member: "Eka Saputra",
          jenis: "registration",
          nominal: 100000,
        },
        {
          tanggal: "2024-11-03",
          generasi: 2,
          member: "Fiona Lestari",
          jenis: "cashback",
          nominal: 300000,
        },
        {
          tanggal: "2024-11-02",
          generasi: 1,
          member: "Gita Maharani",
          jenis: "registration",
          nominal: 100000,
        },
        {
          tanggal: "2024-11-01",
          generasi: 3,
          member: "Hendra Kusuma",
          jenis: "cashback",
          nominal: 200000,
        },
      ];

      const WITHDRAW_DATA = [
        {
          tanggal: "2024-11-05",
          nominal: 1000000,
          status: "success",
          catatan: "Penarikan ke BCA - 1234567890",
        },
        {
          tanggal: "2024-10-25",
          nominal: 500000,
          status: "pending",
          catatan: "Menunggu verifikasi admin",
        },
        {
          tanggal: "2024-10-15",
          nominal: 750000,
          status: "success",
          catatan: "Penarikan ke Mandiri - 0987654321",
        },
        {
          tanggal: "2024-10-05",
          nominal: 2000000,
          status: "failed",
          catatan: "Rekening tidak valid",
        },
      ];

      const RANK_QUALIFIED = [
        { name: "Bronze", count: 15, class: "rank-bronze" },
        { name: "Silver", count: 22, class: "rank-silver" },
        { name: "Gold", count: 12, class: "rank-gold" },
        { name: "Platinum", count: 18, class: "rank-platinum" },
        { name: "Diamond", count: 8, class: "rank-diamond" },
      ];

      const USERS_BY_RANK = {
        Bronze: [
          {
            no: 1,
            username: "bronze001",
            nama: "Ahmad Wijaya",
            wa: "081234567890",
            sponsor: "ADMIN001",
          },
          {
            no: 2,
            username: "bronze002",
            nama: "Budi Santoso",
            wa: "082345678901",
            sponsor: "ADMIN002",
          },
          {
            no: 3,
            username: "bronze003",
            nama: "Citra Dewi",
            wa: "083456789012",
            sponsor: "ADMIN001",
          },
          {
            no: 4,
            username: "bronze004",
            nama: "Dedi Gunawan",
            wa: "084567890123",
            sponsor: "ADMIN003",
          },
          {
            no: 5,
            username: "bronze005",
            nama: "Eka Saputra",
            wa: "085678901234",
            sponsor: "ADMIN002",
          },
        ],
        Silver: [
          {
            no: 1,
            username: "silver001",
            nama: "Fiona Lestari",
            wa: "086789012345",
            sponsor: "ADMIN001",
          },
          {
            no: 2,
            username: "silver002",
            nama: "Gita Maharani",
            wa: "087890123456",
            sponsor: "ADMIN003",
          },
          {
            no: 3,
            username: "silver003",
            nama: "Hendra Kusuma",
            wa: "088901234567",
            sponsor: "ADMIN002",
          },
          {
            no: 4,
            username: "silver004",
            nama: "Indah Sari",
            wa: "089012345678",
            sponsor: "ADMIN001",
          },
          {
            no: 5,
            username: "silver005",
            nama: "Joko Prasetyo",
            wa: "081123456789",
            sponsor: "ADMIN003",
          },
        ],
        Gold: [
          {
            no: 1,
            username: "gold001",
            nama: "Kris Ananda",
            wa: "082234567890",
            sponsor: "ADMIN002",
          },
          {
            no: 2,
            username: "gold002",
            nama: "Luna Amelia",
            wa: "083334567890",
            sponsor: "ADMIN001",
          },
          {
            no: 3,
            username: "gold003",
            nama: "Miko Kusuma",
            wa: "084434567890",
            sponsor: "ADMIN003",
          },
          {
            no: 4,
            username: "gold004",
            nama: "Nina Wijaya",
            wa: "085534567890",
            sponsor: "ADMIN002",
          },
          {
            no: 5,
            username: "gold005",
            nama: "Oscar Pratama",
            wa: "086634567890",
            sponsor: "ADMIN001",
          },
        ],
        Platinum: [
          {
            no: 1,
            username: "platinum001",
            nama: "Putri Azzahra",
            wa: "087734567890",
            sponsor: "ADMIN003",
          },
          {
            no: 2,
            username: "platinum002",
            nama: "Roni Hidayat",
            wa: "088834567890",
            sponsor: "ADMIN002",
          },
          {
            no: 3,
            username: "platinum003",
            nama: "Siti Nurhaliza",
            wa: "089934567890",
            sponsor: "ADMIN001",
          },
          {
            no: 4,
            username: "platinum004",
            nama: "Toni Hermawan",
            wa: "081034567890",
            sponsor: "ADMIN003",
          },
          {
            no: 5,
            username: "platinum005",
            nama: "Ulfa Handika",
            wa: "082134567890",
            sponsor: "ADMIN002",
          },
        ],
        Diamond: [
          {
            no: 1,
            username: "diamond001",
            nama: "Vino Gunawan",
            wa: "083234567890",
            sponsor: "ADMIN001",
          },
          {
            no: 2,
            username: "diamond002",
            nama: "Wina Marlina",
            wa: "084334567890",
            sponsor: "ADMIN003",
          },
          {
            no: 3,
            username: "diamond003",
            nama: "Xander Lee",
            wa: "085434567890",
            sponsor: "ADMIN002",
          },
          {
            no: 4,
            username: "diamond004",
            nama: "Yanti Suryani",
            wa: "086534567890",
            sponsor: "ADMIN001",
          },
          {
            no: 5,
            username: "diamond005",
            nama: "Zaki Mubaraq",
            wa: "087634567890",
            sponsor: "ADMIN003",
          },
        ],
      };

      // üîê CEK AUTHENTICATION
      function checkAuth() {
        const token = localStorage.getItem("authToken");
        const userData = localStorage.getItem("userData");

        if (!token || !userData) {
          console.log("‚ùå Tidak ada token/userData, redirect ke login");
          alert("‚ö†Ô∏è Sesi berakhir. Silakan login kembali.");
          window.location.href = "../login_page.html";
          return null;
        }

        try {
          return JSON.parse(userData);
        } catch (e) {
          console.error("‚ùå Error parsing userData:", e);
          localStorage.clear();
          window.location.href = "../login_page.html";
          return null;
        }
      }

      // üí∞ FORMAT RUPIAH
      function formatRupiah(value) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(value);
      }

      // üìä LOAD DASHBOARD
      function loadDashboard() {
        const user = checkAuth();
        if (!user) return;

        console.log("‚úÖ User data:", user);

        // Ambil data dummy berdasarkan username/id
        const username = String(user.id || user.name || "user123");
        const dashData =
          DUMMY_DATA[username.toLowerCase()] || DUMMY_DATA.user123;
        // Update Profile
        document.getElementById("profileName").textContent =
          user.name || "User";
        // document.getElementById("profileEmail").textContent =
        //   user.email || "user@example.com";
        // document.getElementById("profileRole").textContent =
        //   user.role || "Member";
        document.getElementById(
          "referralLink"
        ).textContent = `https://linkcashback.com/ref/${username}`;

        // Update Statistik Referral
        document.getElementById(
          "totalReferrals"
        ).textContent = `${dashData.totalReferrals} orang`;
        document.getElementById("regCommission").textContent = formatRupiah(
          dashData.regCommission
        );
        document.getElementById("teamBonus").textContent = formatRupiah(
          dashData.teamBonus
        );

        // Update Status Pendapatan
        document.getElementById("totalIncome").textContent = formatRupiah(
          dashData.totalIncome
        );
        document.getElementById("pendingIncome").textContent = formatRupiah(
          dashData.pendingIncome
        );
        document.getElementById("successIncome").textContent = formatRupiah(
          dashData.successIncome
        );
        document.getElementById("availableBalance").textContent = formatRupiah(
          dashData.availableBalance
        );

        // Update Total Penghasilan
        document.getElementById("totalEarnings").textContent = formatRupiah(
          dashData.totalIncome
        );
        document.getElementById("cashbackComission").textContent = formatRupiah(
          dashData.cashbackComission
        );
        document.getElementById("registrationComission").textContent =
          formatRupiah(dashData.registrationComission);

        // Load Generasi
        loadGenerasi(dashData.generasi);

        // Load Team Table
        loadTeamTable(dashData.generasi);

        // Load Status Tim
        document.getElementById("userCount").textContent = dashData.userCount;
        document.getElementById("partnerCount").textContent =
          dashData.partnerCount;

        // Load Rank Qualified
        loadRankGrid();

        // Load Tables
        loadEarningsTable(EARNINGS_DATA);
        loadWithdrawHistory(WITHDRAW_DATA);

        console.log("‚úÖ Dashboard loaded successfully");
      }

      // üë• LOAD GENERASI
      function loadGenerasi(generasi) {
        const grid = document.getElementById("generasiGrid");
        grid.innerHTML = "";
        for (let i = 1; i <= 10; i++) {
          const count = generasi[i] || 0;
          grid.innerHTML += `
            <div class="generasi-card">
              <div class="label">Gen ${i}</div>
              <div class="value">${count}</div>
            </div>
          `;
        }
      }

      // üìã LOAD TEAM TABLE
      function loadTeamTable(generasi) {
        const tbody = document.getElementById("teamTableBody");
        tbody.innerHTML = "";
        for (let i = 1; i <= 10; i++) {
          const members = generasi[i] || 0;
          const regComm = members * 100000;
          const cashComm = Math.floor(Math.random() * 1000000);
          tbody.innerHTML += `
            <tr>
              <td><span class="badge-gen">Gen ${i}</span></td>
              <td>${members}</td>
              <td>${formatRupiah(regComm)}</td>
              <td>${formatRupiah(cashComm)}</td>
              <td><strong>${formatRupiah(regComm + cashComm)}</strong></td>
            </tr>
          `;
        }
      }

      // üí∞ LOAD EARNINGS TABLE
      function loadEarningsTable(data) {
        const tbody = document.getElementById("earningsTableBody");
        tbody.innerHTML = "";
        data.forEach((item) => {
          tbody.innerHTML += `
            <tr>
              <td>${item.tanggal}</td>
              <td><span class="badge-gen">G${item.generasi}</span></td>
              <td>${item.member}</td>
              <td>${item.jenis === "registration" ? "üí≥ Reg" : "üí∞ CB"}</td>
              <td><strong>${formatRupiah(item.nominal)}</strong></td>
            </tr>
          `;
        });
      }

      // üè¶ LOAD WITHDRAW HISTORY
      function loadWithdrawHistory(data) {
        const tbody = document.getElementById("withdrawTableBody");
        tbody.innerHTML = "";
        data.forEach((item) => {
          const badge =
            item.status === "success"
              ? "success"
              : item.status === "pending"
              ? "warning"
              : "danger";
          const icon =
            item.status === "success"
              ? "‚úÖ"
              : item.status === "pending"
              ? "‚è≥"
              : "‚ùå";
          tbody.innerHTML += `
            <tr>
              <td>${item.tanggal}</td>
              <td><strong>${formatRupiah(item.nominal)}</strong></td>
              <td><span class="badge bg-${badge}">${icon} ${item.status.toUpperCase()}</span></td>
              <td>${item.catatan}</td>
            </tr>
          `;
        });
      }

      // üèÖ LOAD RANK GRID
      function loadRankGrid() {
        const grid = document.getElementById("rankGrid");
        grid.innerHTML = "";
        RANK_QUALIFIED.forEach((rank) => {
          const div = document.createElement("div");
          div.className = `rank-card ${rank.class}`;
          div.innerHTML = `
            <h6>${rank.name}</h6>
            <div class="count">${rank.count}</div>
          `;
          div.onclick = () => openRankModal(rank.name);
          grid.appendChild(div);
        });
      }

      // üìä OPEN RANK MODAL
      function openRankModal(rankName) {
        document.getElementById("rankTitle").textContent = rankName;
        const tbody = document.getElementById("rankDetailTableBody");
        tbody.innerHTML = "";

        const users = USERS_BY_RANK[rankName] || [];
        users.forEach((user) => {
          tbody.innerHTML += `
            <tr>
              <td>${user.no}</td>
              <td><strong>${user.username}</strong></td>
              <td>${user.nama}</td>
              <td><a href="https://wa.me/62${user.wa.substring(
                1
              )}" target="_blank">${user.wa}</a></td>
              <td>${user.sponsor}</td>
            </tr>
          `;
        });

        const modal = new bootstrap.Modal(
          document.getElementById("rankDetailModal")
        );
        modal.show();
      }

      // ‚ÑπÔ∏è SHOW INFO MODAL
      // ‚ÑπÔ∏è SHOW INFO MODAL
      function showInfoModal(type) {
        const modalTitle = document.getElementById("infoModalTitle");
        const modalBody = document.getElementById("infoModalBody");

        const infoContent = {
          total: {
            title: "üí∞ Total Pendapatan",
            content: `
              <p>Jumlah total pendapatan dari <strong>Cashback Referral</strong> dan <strong>Marketplace Pribadi & Tim Anda</strong>.</p>
            `,
          },
          pending: {
            title: "‚è≥ Pendapatan Tertunda",
            content: `
              <p>Total pendapatan dari cashback marketplace Pribadi & Tim Anda yang <strong>status transaksinya belum selesai</strong>.</p>
            `,
          },
          success: {
            title: "‚úÖ Pendapatan Berhasil",
            content: `
              <p>Total pendapatan cashback marketplace Pribadi & Tim Anda yang <strong>status transaksinya sudah selesai</strong> dan berhasil mendapatkan cashback.</p>
            `,
          },
        };

        const info = infoContent[type] || infoContent.total;
        modalTitle.innerHTML = info.title;
        modalBody.innerHTML = info.content;

        const modal = new bootstrap.Modal(document.getElementById("infoModal"));
        modal.show();
      }

      // üîç FILTER FUNCTIONS
      function filterEarnings() {
        const gen = document.getElementById("filterGenerasi").value;
        const startDate = document.getElementById("filterTanggalAwal").value;
        const endDate = document.getElementById("filterTanggalAkhir").value;

        let filtered = EARNINGS_DATA.filter((item) => {
          if (gen && item.generasi !== parseInt(gen)) return false;
          if (startDate && item.tanggal < startDate) return false;
          if (endDate && item.tanggal > endDate) return false;
          return true;
        });

        loadEarningsTable(filtered);
      }

      function resetFilter() {
        document.getElementById("filterGenerasi").value = "";
        document.getElementById("filterTanggalAwal").value = "";
        document.getElementById("filterTanggalAkhir").value = "";
        loadEarningsTable(EARNINGS_DATA);
      }

      function filterWithdrawHistory() {
        const startDate = document.getElementById("filterTanggalAwalWD").value;
        const endDate = document.getElementById("filterTanggalAkhirWD").value;

        let filtered = WITHDRAW_DATA.filter((item) => {
          if (startDate && item.tanggal < startDate) return false;
          if (endDate && item.tanggal > endDate) return false;
          return true;
        });

        loadWithdrawHistory(filtered);
      }

      function resetWithdrawFilter() {
        document.getElementById("filterTanggalAwalWD").value = "";
        document.getElementById("filterTanggalAkhirWD").value = "";
        loadWithdrawHistory(WITHDRAW_DATA);
      }

      // üîó UTILITY FUNCTIONS
      function copyReferralLink() {
        const link = document.getElementById("referralLink").textContent;
        navigator.clipboard.writeText(link).then(() => {
          alert("‚úÖ Link referral berhasil disalin!");
        });
      }

      function logout() {
        localStorage.removeItem("authToken");
        localStorage.removeItem("userData");
        window.location.href = "../login_page.html";
      }

      function openWithdrawModal() {
        window.location.href = "./penarikan_saldo.html"; // atau path sesuai struktur folder
      }

      // üöÄ INITIALIZE
      document.addEventListener("DOMContentLoaded", function () {
        console.log("üì± Dashboard initialized");
        loadDashboard();
      });
    </script>
  </body>
</html>
